# load zit
# TODO: Escape does sudo / thefuck
# TODO: zsh-navigation-tools?
export ZIT_MODULES_PATH="${HOME}/.zit.d"
if [[ ! -d "${ZIT_MODULES_PATH}/zit" ]]; then
  git clone "https://github.com/m45t3r/zit" "${ZIT_MODULES_PATH}/zit"
fi
source "${ZIT_MODULES_PATH}/zit/zit.zsh"

# let zit manage zit
zit-install "https://github.com/m45t3r/zit" "zit"

# zim
autoload -U is-at-least
if is-at-least 5.2; then
  export ZIM_HOME="${ZIT_MODULES_PATH}/zim"
  zit-il "https://github.com/Eriner/zim" "zim" "init.zsh"
elif is-at-least 4.3.9; then
  # The plan was to use antigen as a poor man's zim, but the setup seems more
  # involved than I'd like.

  # export ADOTDIR="${ZIT_MODULES_PATH}/antigen"
  # zit-il "https://github.com/zsh-users/antigen" "antigen" "antigen.zsh"
  # antigen init "${HOME}/.antigenrc"
fi

## Fallback theme & plugins
if [ -z "$ZIM_HOME" ]; then
  zit-il "https://github.com/dotcode/multi-shell-repo-prompt" \
    "theme-multi" "prompt.sh"
  zit-il "https://github.com/zdharma/fast-syntax-highlighting" \
    "fast-syntax-highlighting" "fast-syntax-highlighting.plugin.zsh"
  # zit-il "https://github.com/zsh-users/zsh-history-substring-search" \
  #   "zsh-history-substring-search" "zsh-history-substring-search.zsh"
  # bindkey '^[[A' history-substring-search-up
  # bindkey '^[[B' history-substring-search-down
fi

# misc
# zit-il "https://github.com/supercrabtree/k" \
#   "k" "k.sh"
zit-il "https://github.com/djui/alias-tips" \
  "alias-tips" "alias-tips.plugin.zsh"
zit-il "https://github.com/Tarrasch/zsh-autoenv" \
  "zsh-autoenv" "autoenv.zsh"
zit-il "https://github.com/desyncr/auto-ls" \
  "auto-ls" "auto-ls.zsh"
zit-il "https://github.com/willghatch/zsh-saneopt" \
  "sane-defaults" "saneopt.plugin.zsh"

# zsh-async is a prereq for fuzzy search
# zit-il "https://github.com/mafredri/zsh-async" \
#   "zsh-async" "async.zsh"
# zit-il "https://github.com/seletskiy/zsh-fuzzy-search-and-edit" \
#   "zsh-fuzzy-search" "plugin.zsh"
#
# Courtesy of zsh-fuzzy-search-and-edit
# bindkey '^P' fuzzy-search-and-edit

# script to compile ZSH files
# should be called last
zit-lo "zit" "extras/compile-zsh-files.zsh"

# vim: ft=zsh
